<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cybersecurity Atlas</title>
<link rel="stylesheet" href="styles.css">
<link rel="preload" href="data/atlas.json" as="fetch" crossorigin="anonymous">
<script src="app.js" defer></script>
</head>
<body data-feature-favorites="off">
<div class="app layout">
  <button class="hamburger" id="hamburgerBtn" aria-label="Toggle navigation" title="Toggle navigation">☰</button>
  <div class="sidebar-left">
    <aside class="outline-pane" id="outlinePane" aria-label="Outline navigation">
      <header>
        <h2>Outline</h2>
        <button class="btn" id="collapseOutlineBtn" title="Collapse outline" aria-expanded="true">Hide</button>
      </header>
      <div class="outline-tree" tabindex="0" role="tree" aria-label="Atlas outline">
        <ul class="tree-list" id="outlineTree"></ul>
      </div>
      <div class="sr-only" aria-live="polite" id="outlineStatus"></div>
    </aside>
    <aside class="primary">
      <h1>Cybersecurity Atlas</h1>
      <div id="dataFreshness" class="muted" aria-live="polite"></div>
      <div class="muted">Wheel = zoom • drag = pan • click to focus • use toggle ⊕/⊖ to expand • <span class="key">WASD</span> pan • <span class="key">←↑→↓</span> navigate • <span class="key">+</span>/<span class="key">-</span> zoom • <span class="key">Enter</span> toggle • <span class="key">F</span> refocus</div>
      <div class="row search-wrapper">
        <input id="q" type="search" placeholder="Search the atlas" autocomplete="off" aria-label="Search topics" />
        <div id="results" role="listbox" aria-label="Search suggestions" aria-expanded="false"></div>
      </div>
      <div class="row search-options">
        <label class="muted"><input type="checkbox" id="searchSubtree"/> Search within current branch</label>
        <label class="muted"><input type="checkbox" id="searchTags"/> Include tags</label>
      </div>
      <div class="row recent-searches" id="recentSearches" aria-label="Recent searches"></div>
      <div class="row btn-row" role="group" aria-label="Primary actions">
        <button class="btn" id="backBtn" title="Go to previous view">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 12H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="12 19 5 12 12 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Back</span>
        </button>
        <button class="btn" id="centerBtn" title="Center on the current node">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2" fill="none"/><path d="M19 12h2M3 12h2M12 5V3M12 21v-2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span>Center</span>
        </button>
        <button class="btn" id="expandBtn" title="Expand all visible branches">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span>Expand</span>
        </button>
        <button class="btn" id="collapseBtn" title="Collapse to macro buckets">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <span>Collapse</span>
        </button>
        <button class="btn" id="themeBtn" title="Toggle theme">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3a9 9 0 1 0 9 9 5 5 0 0 1-9-9Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>Light</span>
        </button>
        <button class="btn" id="toggleSidebarBtn" title="Collapse sidebar" style="margin-left:auto;">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><polyline points="15 18 9 12 15 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <button class="btn" id="helpBtn" title="Keyboard shortcuts">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="2"/><path d="M9.09 9a3 3 0 1 1 5.91 1c0 2-3 2-3 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="12" y1="17" x2="12.01" y2="17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>

      <!-- Breadcrumb trail to show the current focused path -->
      <div id="breadcrumb" class="row"></div>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M3 4h18l-7 8v6l-4 2v-8L3 4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>Filters</span></div>
      <div id="filters" class="row"></div>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2 2 7l10 5 10-5-10-5Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M2 12l10 5 10-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/><path d="M2 17l10 5 10-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>Macro buckets</span></div>
      <div id="bucketTags" class="row"></div>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 3a9 9 0 1 0 9 9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 7v5l3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Sector legend</span></div>
      <ul id="sectorLegend" class="sector-legend" aria-label="Macro sector legend"></ul>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 21.35 10.45 20.03C5.4 15.36 2 12.27 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.77-3.4 6.86-8.45 11.54L12 21.35Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/></svg>Synthetic overview nodes</span></div>
      <div id="overviewToggleRow" class="row"></div>

      <hr class="divider"/>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 21v-7m0 0 4-4m-4 4-4-4m20 15v-7m0 0 4-4m-4 4-4-4M9 7l3-4 3 4m-3-4v18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Export</span></div>
      <div class="row btn-row">
        <button class="btn" id="png1" title="Download PNG at original size">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="7 10 12 15 17 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>PNG 1×</span>
        </button>
        <button class="btn" id="png2" title="Download PNG at 2×">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="7 10 12 15 17 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>2×</span>
        </button>
        <button class="btn" id="png4" title="Download PNG at 4×">
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="7 10 12 15 17 10" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><line x1="12" y1="15" x2="12" y2="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          <span>4×</span>
        </button>
      </div>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M4 6h16M4 12h10M4 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>Subcategories</span></div>
      <div id="subFilters" class="row"></div>

      <div class="section-label"><span><svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M6 9l6-6 6 6M6 15l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>Tags</span></div>
      <div id="tagFilters" class="tag-list" aria-label="Tag filters"></div>
    </aside>
  </div>
  <!-- Reopen button appears when the sidebar is collapsed.  It floats on the
       left edge of the viewport as a small arrow. -->
  <button id="sidebarReopenBtn" title="Show sidebar">⟩</button>
  <div class="canvas-wrap">
    <div class="canvas-actions">
      <button class="btn" id="resetViewBtn" title="Reset zoom and recenter view">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M21 12a9 9 0 1 1-9-9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="21 3 21 12 12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <span>Reset</span>
      </button>
      <button class="btn fisheye-toggle" id="fisheyeToggleBtn" title="Toggle fisheye focus lens">
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"/></svg>
        <span>Lens</span>
      </button>
    </div>
    <canvas id="c"></canvas>
    <!-- Overview minimap in bottom‑right corner -->
    <canvas id="minimap" width="200" height="200" role="img" aria-label="Atlas minimap"></canvas>
    <button class="btn minimap-touch-toggle" id="minimapTouchToggle" type="button" aria-expanded="false">Touch minimap</button>
    <div id="minimapTouchPanel" class="minimap-touch-panel" hidden aria-hidden="true">
      <div class="minimap-touch-panel__body" role="region" aria-label="Touch minimap navigator">
        <canvas id="minimapTouchCanvas" width="260" height="260"></canvas>
        <p class="muted">Tap or drag inside the map to recenter the view. Use the close button to return.</p>
        <button class="btn" id="minimapTouchClose" type="button">Close</button>
      </div>
    </div>
    <!-- Tooltip for node details -->
    <div id="tooltip"></div>
    <div id="touchPreview" class="touch-preview" hidden aria-live="polite" aria-atomic="true"></div>
    <div class="context-menu" id="contextMenu" role="menu" aria-hidden="true"></div>
    <div id="fatal" aria-live="polite" hidden></div>
    <div id="loadingOverlay" role="status" aria-live="assertive" hidden>
      <div class="spinner" aria-hidden="true"></div>
      <p>Loading atlas data…</p>
    </div>
  </div>
  <!-- Favorites pane removed (feature disabled globally) -->
  <div class="sr-only" aria-live="polite" id="focusAnnounce"></div>
</div>

<!-- Modal overlay for keyboard shortcuts help -->
<div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle" aria-describedby="helpModalBody" hidden>
  <div class="modal-content" tabindex="-1">
    <h2 id="helpModalTitle">Keyboard Shortcuts</h2>
    <ul id="helpModalBody">
      <li><strong>← ↑ → ↓:</strong> Navigate the hierarchy (parent / child / siblings)</li>
      <li><strong>WASD:</strong> Pan the camera</li>
      <li><strong>+</strong> / <strong>-</strong>: Zoom in/out</li>
      <li><strong>Enter:</strong> Expand or collapse the focused node</li>
      <li><strong>F:</strong> Refocus the current selection</li>
      <li><strong>Backspace:</strong> Return to the previous view</li>
      <li><strong>?</strong>: Show this help dialog</li>
    </ul>
    <div class="modal-actions">
      <button id="helpCloseBtn" class="btn">Close</button>
    </div>
  </div>
</div>

<div id="toastRegion" class="toast-region" role="status" aria-live="polite" aria-atomic="true"></div>

</body>
</html>
